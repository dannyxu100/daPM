iChart.Pie=iChart.extend(iChart.Chart,{configure:function(){iChart.Pie.superclass.configure.call(this);this.type="pie";this.set({radius:"100%",offset_angle:0,separate_angle:0,bound_event:"click",counterclockwise:!1,intellectLayout:!0,layout_distance:4,pop_animate:!1,mutex:!1,increment:void 0,sub_option:{label:{}}});this.registerEvent("bound","rebound");this.ILLUSIVE_COO=!0},toggle:function(a){this.sectors[a||0].toggle()},bound:function(a){this.sectors[a||0].bound()},rebound:function(a){this.sectors[a||0].rebound()},getSectors:function(){return this.sectors},doAnimation:function(a,d,b){var f=0,g=b.oA;b.sectors.each(function(e){f=b.animationArithmetic(a,0,e.get("totalAngle"),d);e.push("startAngle",g);e.push("endAngle",g+f);g+=f;b.is3D()||e.drawSector()});b.is3D()&&b.proxy.drawSector()},parse:function(a){a.data.each(function(d,b){a.doParse(a,d,b)},a);a.localizer(a)},doParse:function(a,d,b){var f=d.name+" "+a.getPercent(d.value);a.doActing(a,d,null,b,f);a.push("sub_option.id",b);a.get("sub_option.label")&&a.push("sub_option.label.text",f);a.push("sub_option.listeners.changed",function(b,e){a.fireEvent(a,e?"bound":"rebound",[a,b.get("name")])});a.sectors.push(a.doSector(a,d))},doSector:function(a){return new iChart[a.sub](a.get("sub_option"),a)},dolayout:function(a,d,b,f,g,e){if(a.is3D()?iChart.inEllipse(a.get(a.X)-d,a.topY-b,a.a,a.b):iChart.distanceP2P(a.get(a.X),a.topY,d,b)<a.r)b=a.topY-b,f.push("labelx",a.get(a.X)+(2*Math.sqrt(a.r*a.r-b*b)+g)*(0==e||3==e?1:-1)),f.localizer(f)},localizer:function(a){if(a.get("intellectLayout")){var d=[],b=[],f=a.get("layout_distance"),g,e,h;a.sectors.each(function(a){a.isLabel()&&d.push(a.label)});d.sor(function(a,b){return 0<Math.abs(Math.sin(a.get("angle")))-Math.abs(Math.sin(b.get("angle")))});d.each(function(c){b.each(function(b){e=b.labelx;h=b.labely;if(c.labely<=h&&h-c.labely-1<c.get(a.H)||c.labely>h&&c.labely-h-1<b.get(a.H))if(c.labelx<e&&e-c.labelx<c.get(a.W)||c.labelx>e&&c.labelx-e<b.get(a.W))g=c.get("quadrantd"),c.push("labely",c.get("labely")+h-c.labely+(c.get(a.H)+f)*(1<g?-1:1)),c.localizer(c),a.dolayout(a,c.get("labelx"),c.get("labely")+c.get(a.H)/2*(2>g?-1:1),c,f,g)},a);b.push(c)})}},doConfig:function(){iChart.Pie.superclass.doConfig.call(this);var a=this._(),d=a.get("radius"),b=a.get("sub_option.label")?0.35:0.44,f=2*Math.PI;a.sub=a.is3D()?"Sector3D":"Sector2D";a.sectors=[];a.sectors.zIndex=a.get("z_index");a.components.push(a.sectors);a.oA=iChart.angle2Radian(a.get("offset_angle"))%f;a.is3D()&&(b+=0.06);var g=a.data.length,e=iChart.angle2Radian(iChart.between(0,90,a.get("separate_angle"))),h=f-e,e=e/g,c=a.oA+e,i=c;a.data.each(function(b,d){c+=b.value/a.total*h;d==g-1&&(c=f+a.oA);b.startAngle=i;b.endAngle=c;b.totalAngle=c-i;b.middleAngle=(i+c)/2;i=c+e},a);a.r=d=iChart.parsePercent(d,Math.floor(a.get("minDistance")*b));a.topY=a.originXY(a,[d+a.get("l_originx"),a.get("r_originx")-d,a.get("centerx")],[a.get("centery")]).y;iChart.apply(a.get("sub_option"),iChart.clone([a.X,a.Y,"bound_event","mutex","increment"],a.options))}});
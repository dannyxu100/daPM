(function(c){c.LineSegment=c.extend(c.Component,{configure:function(){c.LineSegment.superclass.configure.apply(this,arguments);this.type="linesegment";this.set({brushsize:1,intersection:!0,label:{},sign:"round",area_color:null,hollow:!0,hollow_inside:!0,hollow_color:"#FEFEFE",smooth:!1,smoothing:1.5,point_size:6,points:[],keep_with_coordinate:!1,shadow_blur:1,shadow_offsety:1,point_space:0,coordinate:null,event_range_x:0,limit_y:!1,tip_offset:2,event_range_y:0});this.registerEvent("parseText");this.tip=null},drawSegment:function(){var a=this._();a.get("points");a.get("f_color");a.get("brushsize");a.polygons.each(function(b){a.T.polygon.apply(a.T,b)});a.T.shadowOn(a.get("shadow"));a.lines.each(function(b){a.T.lineArray.apply(a.T,b)});a.intersections.each(function(b){a.sign_plugin?a.sign_plugin_fn.apply(a,b):a.T.round0.apply(a.T,b)});a.get("shadow")&&a.T.shadowOff()},doDraw:function(a){a.drawSegment();a.get("label")&&a.labels.each(function(a){a.draw()})},isEventValid:function(){},tipInvoke:function(){var a=this.x,b=this.get("tip_offset"),c=this.get("point_size")+b,e=this;return function(d,i,f){var j=f.left,f=f.top,j=3>e.tipPosition&&0<j-d-a-b||2<e.tipPosition&&0>j-d-a-b?j-(d+b):j+b,f=0==e.tipPosition%2?f+c:f-i-c;return{left:j,top:f}}},PP:function(a,c,m,e,d,i){a.get("area")&&a.polygons.push([a.get("area_color")||a.get("light_color2"),0,a.get("brushsize"),0,0,a.get("area_opacity"),a.get("smooth")?c:[{x:m,y:e}].concat(c.concat([{x:d,y:i}])),a.get("smooth"),a.get("smoothing")||1.5,[{x:m,y:e},{x:d,y:i}]])},parse:function(a){a.polygons=[];a.lines=[];a.intersections=[];a.labels=[];var b=a.get("points"),m=a.get("intersection"),e=!!a.get("label"),d=[],i=!1,f=a.get("smooth"),j=a.get("smoothing")||1.5,k=a.get("f_color"),n=a.get("brushsize"),h=a.get("point_size");if(m){var o=a.getPlugin("sign"),g=k,l=a.get("hollow_color");a.sign_plugin=c.isFunction(o);a.sign_plugin_fn=o;a.get("hollow_inside")&&(g=l,l=k)}b.each(function(b){b.x_=b.x;b.y_=b.y;!b.ignored&&e&&(a.push("label.originx",b.x),a.push("label.originy",b.y-h/2-1),a.push("label.text",a.fireString(a,"parseText",[a,b.value],b.value)),c.applyIf(a.get("label"),{textBaseline:"bottom",color:a.get("f_color")}),a.labels.push(new c.Text(a.get("label"),a)));b.ignored&&i?(a.lines.push([d,n,k,f,j]),a.PP(a,d,d[0].x,a.y,d[d.length-1].x,a.y),d=[],i=!1):b.ignored||(d.push(b),i=!0);m&&!b.ignored&&a.intersections.push(a.sign_plugin?[a.T,a.get("sign"),b,h,g,l]:a.get("hollow")?[b,h/2-n+1,g,n+1,l]:[b,h/2,g])});d.length&&(a.lines.push([d,n,k,f,j]),a.PP(a,d,d[0].x,a.y,d[d.length-1].x,a.y))},doConfig:function(){c.LineSegment.superclass.doConfig.call(this);c.Assert.isTrue(0<this.get("point_space"),"point_space");var a=this._(),b=3*a.get("point_size")/2,m=a.get("point_space"),e=a.get("event_range_y"),d=a.get("event_range_x"),i=a.get("tipInvokeHeap"),f=a.get("points"),j=a.get("name");a.parse(a);if(0>=d||d>m/2)d=a.push("event_range_x",m/2);0==e&&(e=a.push("event_range_y",b/2));a.get("tip.enable")&&(a.on("mouseover",function(){i.push(a);a.tipPosition=i.length}).on("mouseout",function(){i.pop()}),a.push("tip.invokeOffsetDynamic",!0),a.tip=new c.Tip(a.get("tip"),a));var k=a.get("coordinate"),n=a.get("limit_y"),h=a.get("keep_with_coordinate"),o=function(a,b,c){return!a.ignored&&Math.abs(b-a.x)<d&&(!n||n&&Math.abs(c-a.y)<e)?true:false},g=function(a){return{valid:true,name:j,value:f[a].value,text:f[a].text,top:f[a].y,left:f[a].x,i:a,hit:true}};a.isEventValid=function(b){if(k&&!k.isEventValid(b,k).valid)return{valid:false};var d=Math.floor((b.x-a.x)/m);if(d<0||d>=f.length-1){d=c.between(0,f.length-1,d);return o(f[d],b.x,b.y)?g(d):{valid:h}}for(var e=d;e<=d+1;e++)if(o(f[e],b.x,b.y))return g(e);return{valid:h}}}});c.Line=c.extend(c.Chart,{configure:function(){c.Line.superclass.configure.call(this);this.type="line";this.set({brushsize:1,coordinate:{axis:{width:[0,0,2,2]}},crosshair:{enable:!1},tipMocker:null,tipMockerOffset:null,scaleAlign:"left",labelAlign:"bottom",labels:[],label_space:6,proportional_spacing:!0,point_space:null,sub_option:{},legend:{sign:"bar"},label:{}});this.registerEvent("parsePoint")},getCoordinate:function(){return this.coo},doConfig:function(){c.Line.superclass.doConfig.call(this);var a=this._(),b=1==a.data.length;a.lines=[];a.lines.zIndex=a.get("z_index");a.components.push(a.lines);var m=a.pushIf("sub_option.keep_with_coordinate",b);a.get("crosshair.enable")&&(a.push("crosshair.hcross",b),a.push("crosshair.invokeOffset",function(b){b=a.lines[0].isEventValid(b);return b.valid?b:m}));a.Combination||(a.push("coordinate.crosshair",a.get("crosshair")),a.pushIf("coordinate.scale",[{position:a.get("scaleAlign"),max_scale:a.get("maxValue")},{position:a.get("labelAlign"),start_scale:1,scale:1,end_scale:a.get("maxItemSize"),labels:a.get("labels"),label:a.get("label")}]));a.coo=c.Coordinate.coordinate_.call(a);a.Combination&&(a.coo.push("crosshair",a.get("crosshair")),a.coo.doCrosshair(a.coo));var b=a.coo.get("valid_width"),e=a.coo.get("valid_height"),d=b/(a.get("maxItemSize")-1),i=a.get("point_space");a.get("proportional_spacing")&&(i&&i<d?b=(a.get("maxItemSize")-1)*i:a.push("point_space",d));a.push("sub_option.width",b);a.push("sub_option.height",e);a.push("sub_option.originx",a.coo.get("x_start")+(a.coo.get("valid_width")-b)/2);a.push("sub_option.originy",a.coo.get(a.Y)+a.coo.get(a.H));if(a.get("tip.enable")&&c.isFunction(a.get("tipMocker"))){a.push("sub_option.tip.enable",!1);a.push("tip.invokeOffsetDynamic",!0);var f,j=a.coo.get(a.X),k=a.coo.get(a.Y),n=a.coo.get(a.H),h=a.get("tipMockerOffset"),o,g,l,h=c.isNumber(h)?0>h?0:1<h?1:h:null;a.push("tip.invokeOffset",function(a,b,c){if(h!=null)c.top=k+(n-b)*h;else{c.top=c.maxTop-(c.maxTop-c.minTop)/3-b;if(b>n||k>c.top)c.top=k}return{left:c.left-a-j>5?c.left-a-5:c.left+5,top:c.top}});var p=a.get("tip.listeners.parseText");p&&delete a.get("tip.listeners").parseText;b=new c.Custom({eventValid:function(b){g=a.lines[0].isEventValid(b);g.hit=o!=g.i;if(g.valid){o=g.i;f=[];a.lines.each(function(a,c){l=a.isEventValid(b);if(c==0)g.minTop=g.maxTop=l.top;else{g.minTop=Math.min(g.minTop,l.top);g.maxTop=Math.max(g.maxTop,l.top)}f.push(p?p(null,l.name,l.value,l.text,l.i):l.name+" "+l.value)});g.text=a.get("tipMocker").call(a,f,g.i)||"tipMocker not return"}return g.valid?g:false}});new c.Tip(a.get("tip"),b);a.components.push(b)}c.applyIf(a.get("sub_option"),c.clone(["area_opacity"],a.options))}});c.LineBasic2D=c.extend(c.Line,{configure:function(){c.LineBasic2D.superclass.configure.call(this);this.type="basicline2d";this.tipInvokeHeap=[]},doAnimation:function(a,b,c){c.lines.each(function(e){e.get("points").each(function(d){d.y=e.y-Math.ceil(c.animationArithmetic(a,0,e.y-d.y_,b))});e.drawSegment()})},doConfig:function(){c.LineBasic2D.superclass.doConfig.call(this);var a=this._(),b,m=a.coo.get("valid_height"),e=a.get("point_space"),d,i,f,j=a.get("sub_option.originx"),k,n;a.push("sub_option.tip.showType","follow");a.push("sub_option.coordinate",a.coo);a.push("sub_option.tipInvokeHeap",a.tipInvokeHeap);a.push("sub_option.point_space",e);a.data.each(function(h){b=a.coo.getScale(h.scaleAlign||a.get("scaleAlign"));k=a.get("sub_option.originy")-b.basic*m;d=[];h.value.each(function(o,g){i=e*g;f=(o-b.start)*m/b.distance;n={x:j+i,y:k-f,value:o,text:h.name+" "+o};c.merge(n,a.fireEvent(a,"parsePoint",[h,o,i,f,g]));d.push(n)},a);c.merge(a.get("sub_option"),h);a.push("sub_option.points",d);a.push("sub_option.brushsize",h.linewidth||h.line_width||1);a.lines.push(new c.LineSegment(a.get("sub_option"),a))},this)}});c.Area2D=c.extend(c.LineBasic2D,{configure:function(){c.Area2D.superclass.configure.call(this);this.type="area2d";this.set({area_opacity:0.3})},doConfig:function(){this.push("sub_option.area",!0);c.Area2D.superclass.doConfig.call(this)}})})(iChart);